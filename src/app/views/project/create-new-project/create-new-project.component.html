<div class="container-fluid webView p-20">
    <div class="generic-form bg mx-2">
        <form [formGroup]='projectForm' (ngSubmit)='addProject()'>
            <div class="row create-project">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="py-3">
                        <h5 class="py-1"><b>Project Details</b></h5>
                        <p>Lets dig into the project details!</p>
                    </div>
                    <div class="row">
                        
                        <!-- client dropdown -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Select Client <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="client_id" autocomplete="off" placeholder="Select"
                                    panelClass="custom-select-panel" [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of allClientList" [value]="item.id">
                                        {{item.clint_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['client_id']?.touched && f['client_id']?.invalid">
                                <span class="text-errors" *ngIf="f['client_id'].errors?.['required']">Client name is
                                    required</span>
                            </div>
                        </div>
                        <!-- project name -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Enter Project Name <b class="r-star">*</b></mat-label>
                                <input matInput placeholder="Enter project name" formControlName="project_name"
                                    autocomplete="off">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['project_name']?.touched && f['project_name']?.invalid">
                                <span class="text-errors"
                                    *ngIf="f['project_name'].errors && f['project_name'].errors['required'] ">Project name is
                                    required</span>
                                <span class="text-errors"
                                    *ngIf="f['project_name'].invalid && f['project_name'].hasError('pattern')">
                                    Cannot start with a space.
                                </span>
                            </div>
                        </div>
                        <!-- start date -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                <mat-label>Start Date <b class="r-star">*</b></mat-label>
                                <input matInput [matDatepicker]="picker" placeholder="Enter start date"
                                    formControlName="start_date" autocomplete="off" (dateInput)="onChange($event)">
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                     <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['start_date']?.touched && f['start_date']?.invalid">
                                <span class="text-errors" *ngIf="f['start_date'].errors?.['required']">Start date
                                    is required</span>
                            </div>
                        </div>
                        <!-- end date -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                <mat-label>End Date <b class="r-star">*</b></mat-label>
                                <input matInput  [matDatepicker]="picker1" placeholder="Enter end date"
                                    formControlName="end_date" (dateInput)="yearEndDateValidator()"
                                    [min]="projectForm.value.start_date">
                                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                                    <mat-datepicker #picker1></mat-datepicker>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['end_date']?.touched && f['end_date']?.invalid">
                                <span class="text-errors" *ngIf="f['end_date'].errors?.['required']">End date is
                                    required</span>
                            </div>
                        </div>
                        <!-- project manager -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Project Manager <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="project_manager_id" autocomplete="off"
                                    placeholder="Select manager" panelClass="custom-select-panel"
                                    [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of allManager" [value]="item.id">
                                        {{item.u_first_name +" "+ item.u_last_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2"
                                *ngIf="f['project_manager_id']?.touched && f['project_manager_id']?.invalid">
                                <span class="text-errors"
                                    *ngIf="f['project_manager_id'].errors?.['required']">Manager is
                                    required</span>
                            </div>
                        </div>
                        <!-- estimated hours -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Estimated Hours <b class="r-star">*</b></mat-label>
                                <input matInput type="number" onkeydown="return event.keyCode !== 69"
                                    oninput="this.value = this.value.replace('.', '').replace(/[^\d]/g, '');" appHypen
                                    formControlName="estimated_hour" placeholder="Enter estimated hours">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['estimated_hour'].touched && f['estimated_hour'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['estimated_hour'].errors && f['estimated_hour'].errors['required']">Estimated
                                    hours is required</span>
                            </div>
                        </div>
                        <!-- billing -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Estimated Billing <b class="r-star">*</b></mat-label>
                                <input matInput placeholder="Enter billing amount"
                                    onkeydown="return event.keyCode !== 69 " formControlName="estimated_billing"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['estimated_billing'].touched && f['estimated_billing'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['estimated_billing'].errors && f['estimated_billing'].errors['required']">Estimated
                                    billing is required</span>
                            </div>
                        </div>
                        <!-- project status -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-3">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Project Status <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="status_id" autocomplete="off" placeholder="Select status"
                                    panelClass="custom-select-panel" [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of status" [value]="item.id">
                                        {{item.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['status_id']?.touched && f['status_id']?.invalid">
                                <span class="text-errors" *ngIf="f['status_id'].errors?.['required']">Status is
                                    required</span>
                            </div>
                        </div>
                        <!-- select team -->
                        <div class="col-sm-12 col-md-6 col-lg-6 mb-3 multi-select">
                            <!-- <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Select Team <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="team" autocomplete="off"
                                    placeholder="Select team" panelClass="custom-select-panel"
                                    [disableOptionCentering]="true" multiple (selectionChange)="matTeamSelect($event)">
                                    <mat-option *ngFor="let item of allPeopleGroup" [value]="item.id ">
                                        {{item.first_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field> -->
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Select Team <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="team" autocomplete="off"
                                    placeholder="Select team" panelClass="custom-select-panel"
                                    [disableOptionCentering]="true" multiple (selectionChange)="matTeamSelect()"
                                        [(ngModel)]="selectedTeamId">
                                    
                                    <!-- Search Input -->
                                    <div class="custom-search py-2 px-1">
                                        <input matInput (input)="filterOptions($event)" placeholder="Search..." />
                                    </div>
                            
                                    <mat-option *ngFor="let item of filteredPeopleGroup" [value]="item.id">
                                        {{item.first_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['team'].touched && f['team'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['team'].errors && f['team'].errors['required']">Team
                                    list is required</span>
                            </div>
                        </div>
                        <div *ngIf="assigneePeoples.length!=0" class="col-sm-12 col-md-6  col-lg-6 team-border mb-3">
                            <!-- <div class="team-mates" *ngFor="let item of assigneePeoples">
                                <span class="">{{item.first_name}}</span>
                                <span class="team-close-icon"> <i class="bi bi-x fs-5 fw-bold" (click)="teamDeselectedFromCard(item.id)"></i></span>
                            </div> -->
                            <div class="tag-container" [ngClass]="{ 'collapsed': isCollapsed }">
                                <span *ngFor="let item of assigneePeoples" class="tag-item">
                                  {{item.first_name}}<i class="bi bi-x fs-5 fw-bold" (click)="teamDeselectedFromCard(item.id)"></i>
                                  <!-- <button (click)="teamDeselectedFromCard(item.id)" class="remove-btn">X</button> -->
                                </span>
                              </div>
                              
                              <div class="controls mb-2">
                                <button type="button" (click)="clearAll()" class="clear-btn">Clear all</button>
                                <button type="button" (click)="toggleCollapse()" class="toggle-btn">
                                  {{ isCollapsed ? 'Expand' : 'Collapse' }}
                                </button>
                              </div>
                            
                        </div>
                    </div>
                    <!-- project template -->
                    <div class="row px-3 gx-0 task-border">
                        <div class="col-6 ">
                            <div class="py-3">
                                <h5 class="py-1"><b>Add Tasks</b></h5>
                                <p>Create multiple tasks</p>
                            </div>
                        </div>
                        <div class="col-6 text-end align-content-center"
                            *ngIf="projectForm.get('project_task').valid">
                            <div *ngIf="projectForm.get('project_task').valid">
                                <button mat-icon-button class="proceedbtn" type="button" color="primary"
                                    (click)="addTask()">
                                    <mat-icon>add</mat-icon>Add Task 
                                </button>
                            </div>
                        </div>
                        <div class="col-6 text-end align-content-center invalid-button"
                            *ngIf="projectForm.get('project_task').invalid">
                            <div *ngIf="projectForm.get('project_task').invalid">
                                <button mat-icon-button type="button" class="proceedbtn" color="primary" disabled>
                                    <mat-icon>add</mat-icon>Add Task 
                                </button>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="row">
                                <div class="col-3 mb-3">
                                    <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                        <mat-label>Choose Template <b class="r-star">*</b></mat-label>
                                        <mat-select formControlName="project_category" autocomplete="off"
                                            placeholder="Select template" panelClass="custom-select-panel"
                                            [disableOptionCentering]="true" (selectionChange)="getSubTask($event)">
                                            <mat-option *ngFor="let item of taskCategories" [value]="item.id">
                                                {{item.category_name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                    <!-- <div class="px-2"
                                        *ngIf="f['project_category'].touched && f['project_category'].invalid">
                                        <span class="text-errors"
                                            *ngIf="f['project_category'].errors && f['project_category'].errors['required']">
                                            Template category is required
                                        </span>
                                    </div> -->
                                </div>
                            </div>
                        </div>

                        <div class="col-12 px-2" formArrayName="project_task">
                            <div class="" *ngFor="let task of subTasks.controls; let i = index;">
                                <div [formGroupName]="i" class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-10 mb-3">
                                        <div class="row align-items-center border rounded"
                                            [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}"
                                            style="border-color: #007bff;">
                                            <div class="col-auto border-end">
                                                <span class="font-weight-bold">{{i+1}}</span>
                                            </div>
                                            <div class="col mt-1 border-end">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Task Name</mat-label><b class="r-star">*</b>
                                                </div>
                                                <input matInput type="text" [formControlName]="'task_name'" [ngClass]="{'auto-height': true}"
                                                    placeholder="Enter task name" [readonly]="task.value.edit_icon"
                                                    [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}">
                                                <!-- </textarea> -->
                                            </div>
                                            <div class="col border-end">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Status</mat-label><b class="r-star">*</b>
                                                </div>
                                                <mat-select [formControlName]="'status'" autocomplete="off"
                                                        placeholder="Select status" panelClass="custom-select-panel"
                                                        [disableOptionCentering]="true">
                                                        <mat-option [disabled]="task.value.edit_icon"
                                                        *ngFor="let status of status" [value]="status.value">
                                                        {{status.viewValue}}
                                                        </mat-option>
                                                </mat-select>
                                                <!-- <select [formControlName]="'status'" autocomplete="off"
                                                    placeholder="Select" class="form-select"
                                                    [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}">
                                                    <option value="" selected hidden>Status</option>
                                                    <option [disabled]="task.value.edit_icon"
                                                        *ngFor="let status of status" [value]="status.value">
                                                        {{status.viewValue}}</option>
                                                </select> -->
                                            </div>
                                            <div class="col mt-1">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Assignee</mat-label><b class="r-star">*</b>
                                                </div>
                                                <mat-select [formControlName]="'assignee'" autocomplete="off"
                                                        placeholder="Select assignee" panelClass="custom-select-panel"
                                                        [disableOptionCentering]="true">
                                                        <mat-option [disabled]="task.value.edit_icon"
                                                            *ngFor="let item of assigneePeoples" [value]="item.id">
                                                            {{item.u_first_name}}
                                                        </mat-option>
                                                </mat-select>
                                                <!-- <mat-form-field appearance="outline"
                                                    class="w-100 custom-mat-form-field">
                                                    <mat-label>Assignee <b class="r-star">*</b></mat-label>
                                                    <mat-select [formControlName]="'assignee'" autocomplete="off"
                                                        placeholder="Select assignee" panelClass="custom-select-panel"
                                                        [disableOptionCentering]="true">
                                                        <mat-option [disabled]="task.value.edit_icon"
                                                            *ngFor="let item of assigneePeoples" [value]="item.id">
                                                            {{item.u_first_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field> -->
                                                <!-- <select [formControlName]="'assignee'" autocomplete="off"
                                                    placeholder="Select team" class="form-select"
                                                    [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}">
                                                    <option value="" disabled selected >Assignee</option>
                                                    <option [disabled]="task.value.edit_icon"
                                                        *ngFor="let item of assigneePeoples" [value]="item.id">
                                                        {{item.u_first_name}}
                                                    </option>
                                                </select> -->
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-auto">

                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('task_name').invalid && (task.get('task_name').dirty || task.get('task_name').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('task_name')?.errors?.['required']">
                                                        Task name is required.
                                                    </span>
                                                    <span class="text-errors"
                                                        *ngIf="task.get('task_name').invalid && task.get('task_name').hasError('pattern')">
                                                        Cannot start with a space.
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('status').invalid && (task.get('status').dirty || task.get('status').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('status')?.errors?.['required']">
                                                        Status is required.
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('assignee').invalid && (task.get('assignee').dirty || task.get('assignee').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('assignee')?.errors?.['required']">
                                                        Assignee is required.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2 mb-3 d-flex ps-4 align-items-center">
                                        <i class="bi bi-check-lg me-1 icon-bg" *ngIf="!task.value.is_saved"
                                            container="body" style="color:#50C20D;" (click)="save(i)"
                                            ngbTooltip="Save"></i>
                                        <i class="bi bi-x-circle icon-bg" container="body"
                                            *ngIf="!task.value.is_saved && task.value.is_cancelled"
                                            style="color:#126EB4;margin-right: 5px;" ngbTooltip="Cancel"
                                            (click)="cancelEdit(i)"></i>
                                        <i class="bi bi-pencil-square me-1 icon-bg" *ngIf="task.value.is_saved"
                                            container="body" style="color:#367ab7;" (click)="editTask(i)"
                                            ngbTooltip="Edit"></i>
                                        <i class="bi bi-trash icon-bg"
                                            *ngIf="!task.value.is_saved && subTasks.length!=1" container="body"
                                            style="color:red;" (click)="openDeleteConfirmation(i)"
                                            ngbTooltip="Delete"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row mt-3">
                        <div>
                            <button type="submit" mat-raised-button class="proceedbtn" color="primary">Submit</button>
                        </div>
                    </div>

                    <!-- old ui -->
                    <!-- <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="row">
                        <div class="col-sm">
                            <h4>Project details</h4>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm">
                            <p>Client <span>*</span></p>
                            <select class="form-select" [(value)]='client' aria-label="Default select example"
                                formControlName="client_id">
                                <option value="" selected disabled>Select client</option>
                                <option *ngFor="let item of allClientList" [value]="item.id">
                                    {{item.c_name}}
                                </option>
                            </select>
                            <div *ngIf="f['client_id'].touched && f['client_id'].invalid">
                                <div *ngIf="f['client_id'].errors && f['client_id'].errors['required']">
                                    <p class="error-msg">Client name is required</p>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <p>Project name <span>*</span></p>
                            <input type="text" class="form-control p-3 sizeinput" formControlName="project_name"
                                placeholder="Enter project name" aria-describedby="emailHelp" autocomplete="off">
                            <div *ngIf="f['project_name'].touched && f['project_name'].invalid">
                                <div *ngIf="f['project_name'].errors && f['project_name'].errors['required'] ">
                                    <p class="error-msg">Project name is required</p>
                                </div>
                            </div>
                            <div *ngIf="f['project_name'].invalid && f['project_name'].hasError('pattern')">
                                <p class="error-msg">Cannot start with a space.</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm">
                            <p>Description </p>
                            <div class="">
                                <textarea class="form-control  sizeinput" placeholder="Enter your description.."
                                    formControlName="p_description" style="height: 42px"></textarea>
                                <div *ngIf="f['p_description'].touched && f['p_description'].invalid">
                                    <div *ngIf="f['p_description'].errors && f['p_description'].errors['required'] ">
                                        <p class="error-msg">Description is required</p>
                                    </div>
                                </div>
                                <div *ngIf="f['p_description'].invalid && f['p_description'].hasError('pattern')">
                                    <p class="error-msg">Cannot start with a space.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row pt-0">
                        <div class="col-sm">
                            <p>Start date<span>*</span></p>
                            <input class="form-control p-3 sizeinput" formControlName="start_date" type="date"
                                name="date-input" placeholder="date" (change)="onChange()">
                            <div *ngIf="f['start_date'].touched && f['start_date'].invalid">
                                <div *ngIf="f['start_date'].errors && f['start_date'].errors['required'] ">
                                    <p class="error-msg"></p>
                                </div>Start date is required
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm">
                            <p>End date<span>*</span></p>
                            <input class="form-control p-3 sizeinput" [min]="projectForm.value.start_date"
                                formControlName="end_date" type="date" name="date-input" placeholder="date"
                                (change)="yearEndDateValidator()">
                            <div *ngIf="f['end_date'].touched && f['end_date'].invalid">
                                <div *ngIf="f['end_date'].errors && f['end_date'].errors['required'] ">
                                    <p class="error-msg">End date is required</p>
                                </div>
                            </div>
                            <div *ngIf="invalidDate">
                                <p class="error-msg">End date should be greater than start date.</p>
                            </div>
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-sm">

                            <p>Employee list <span>*</span></p>
                            <div style="margin: 0;" class="row container-fluid">
                                <ng-multiselect-dropdown [placeholder]="'Select employee list'"
                                    [settings]="peopleListSetting" [data]="allPeopleGroup"
                                    (onSelect)="onPeopleGroupSelect($event)"
                                    (onSelectAll)="onPeopleGroupSelectAll($event)" formControlName="team">
                                </ng-multiselect-dropdown>

                                <div *ngIf="f['team'].touched && f['team'].invalid">
                                    <div *ngIf="f['team'].errors && f['team'].errors['required']">
                                        <p class="error-msg">Employee list is required</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <p>Project Status <span>*</span></p>
                            <select class="form-select sizeinput" aria-label="Default select example"
                                formControlName="status_id">
                                <option value="" disabled selected>Select Status</option>
                                <option *ngFor="let status of status" [value]="status.value">{{status.viewValue}}
                                </option>
                            </select>
                            <div *ngIf="f['status_id'].touched && f['status_id'].invalid">
                                <div *ngIf="f['status_id'].errors && f['status_id'].errors['required']">
                                    <p class="error-msg">Project Status is required</p>
                                </div>

                            </div>
                        </div>
                    </div>

                </div> -->
                    <div class="col-sm-12 col-md-12 col-lg-6">
                        <!-- <div class="row">
                        <div class="col-sm">
                            <h4>Estimation/manager/approver details</h4>
                        </div>
                    </div> -->


                        <!-- <div class="row">
                        <div class="col-sm">
                            <p>Estimated hours <span>*</span></p>
                            <input type="number" class="form-control p-3 sizeinput"
                                onkeydown="return event.keyCode !== 69"
                                oninput="this.value = this.value.replace('.', '').replace(/[^\d]/g, '');" appHypen
                                class="form-control" formControlName="estimated_hour"
                                placeholder="Enter estimated hours" aria-label="Username"
                                aria-describedby="basic-addon1">
                        </div>
                        <div *ngIf="f['estimated_hour'].touched && f['estimated_hour'].invalid">
                            <div *ngIf="f['estimated_hour'].errors && f['estimated_hour'].errors['required']">
                                <p class="error-msg">Estimated hours is required</p>
                            </div>
                        </div>
                    </div> -->

                        <!-- <div class="row">
                        <div class="col-sm">
                            <p>Estimated billing <span>*</span></p>
                            <input type="number" class="form-control p-3 sizeinput"
                                onkeydown="return event.keyCode !== 69 " class="form-control"
                                formControlName="estimated_billing" placeholder="Enter estimated billing"
                                aria-label="Username" aria-describedby="basic-addon1">

                        </div>
                        <div *ngIf="f['estimated_billing'].touched && f['estimated_billing'].invalid">
                            <div *ngIf="f['estimated_billing'].errors && f['estimated_billing'].errors['required']">
                                <p class="error-msg">Estimated billing is required</p>
                            </div>
                        </div>

                    </div> -->


                        <!-- <div class="row">
                        <div class="col-sm">
                            <p>Reporting manager <span>*</span></p>
                            <select class="form-select sizeinput" [(value)]='reporting_manager'
                                aria-label="Default select example" formControlName="project_manager_id">
                                <option value="" disabled selected>Select reporting manager</option>
                                <option *ngFor="let item of allManager" [value]="item.id">
                                    {{item.u_first_name +" "+ item.u_last_name}}
                                </option>
                            </select>
                            <div *ngIf="f['project_manager_id'].touched && f['project_manager_id'].invalid">
                                <div
                                    *ngIf="f['project_manager_id'].errors && f['project_manager_id'].errors['required'] ">
                                    <p class="error-msg">Reporting manager is required</p>
                                </div>
                            </div>
                        </div>
                    </div> -->

                        <!-- <div class="row">
                        <div class="col-sm">
                            <p>Approver <span>*</span></p>
                            <select class="form-select sizeinput" [(value)]='approver_manager'
                                aria-label="Default select example" formControlName="approve_manager_ref_id">
                                <option value="" disabled selected>Select approver</option>
                                <option *ngFor="let item of allManager" [value]="item.id">
                                    {{item.u_first_name +''+ item.u_last_name}}
                                </option>
                            </select>
                            <div *ngIf="f['approve_manager_ref_id'].touched && f['approve_manager_ref_id'].invalid">
                                <div
                                    *ngIf="f['approve_manager_ref_id'].errors && f['approve_manager_ref_id'].errors['required']">
                                    <p class="error-msg">Approver is required</p>
                                </div>
                            </div>
                        </div>
                    </div> -->


                        <!-- <div class="row">
                        <div class="col-sm">
                            <p> Add task & File templates <span>*</span></p>
                            <select class="form-select sizeinput" (change)="getSubTask($event)"
                                aria-label="Default select example" formControlName="p_task_checklist_status">
                                <option value="" disabled selected>Select task category</option>
                                <option *ngFor="let item of taskCategories" [value]="item.id">
                                    {{item.category_name}}
                                </option>
                            </select>
                            <div *ngIf="f['p_task_checklist_status'].touched && f['p_task_checklist_status'].invalid">
                                <div
                                    *ngIf="f['p_task_checklist_status'].errors && f['p_task_checklist_status'].errors['required']">
                                    <p class="error-msg">Task category is required</p>
                                </div>
                            </div>
                        </div>

                    </div> -->

                        <!-- <div class="row">
                        <div class="col-sm-12">
                            <p> Sub task <span>*</span></p>
                            <select class="form-select  sizeinput" (change)="subTask($event)"
                                aria-label="Default select example" formControlName="project_task">
                                <option value="" disabled selected>Select sub task category</option>
                                <option *ngFor="let item of subTaskCategories" [value]="item?.task_name">
                                    {{item.task_name?item.task_name:"NO RECORDS FOUND"}}
                                </option>
                            </select>

                            <div
                                *ngIf="f['project_task'].touched && f['project_task'].invalid">
                                <div
                                    *ngIf="f['project_task'].errors && f['project_task'].errors['required']">
                                    <p class="error-msg">Sub task category is required</p>
                                </div>
                            </div>


                        </div>

                    </div> -->

                        <!-- <div class="row">
                <div class="col-sm">
                    <p>Project status  <span >*</span></p>
                <select class="form-select  sizeinput"  aria-label="Default select example" formControlName="status_id">                       
                    <option value="" disabled selected>Select status</option>
                    <option value="Open">Open</option>
                    <option value="Pending" >Pending</option>
                  </select>
                <div *ngIf="f['status_id'].touched && f['status_id'].invalid" >
                    <div *ngIf="f['status_id'].errors && f['status_id'].errors['required']"><p class="error-msg">Status is required</p></div>
                </div>
                </div>
            </div> -->
                        <!-- <div class="row mobileView">
                <div class="col-sm-6">
                    <p><i class="bi bi-newspaper"></i>Note: <span>*</span>Mandatory fields</p>
                </div>
            </div> -->



                    </div>
                    <!-- <div class="row">

                        <div class="col-12">
                            <button mat-button type="button" class="add-task" (click)="addTask()"><i
                                    class="bi bi-check2-circle"></i> Add Task</button>
                        </div>
                    </div> -->

                    <!-- <form [formGroup]="taskForm">
                        <div formArrayName="subTasks">
                            <div *ngFor="let task of subTasks?.controls; let i = index;">
                                <div [formGroupName]="i">
                                    <mat-card>
                                        <div class="row">
                                           
                                            <div class="col-6">
                                                <mat-form-field class="example-form-field">
                                                    <mat-label>Add Task Here</mat-label>
                                                    <textarea matInput formControlName="task_name"
                                                        class="mat-add-input"></textarea>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-3">
                                                <mat-form-field>
                                                    <mat-label>Status</mat-label>
                                                    <mat-select formControlName="status">
                                                        <mat-option *ngFor="let status of status"
                                                            [value]="status.value">{{status.viewValue}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-3">
                                                <mat-form-field>
                                                    <mat-label>Assignee</mat-label>
                                                    <mat-select formControlName="assignee">
                                                        <mat-option *ngFor="let people of allPeopleGroup"
                                                            [value]="people.id">{{people.u_first_name}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>


                                            </div>
                                            <div class="row mb-0 m">

                                                <div class="col-3">
                                                    <button mat-button color="primary" (click)="addTask()"
                                                        class="add-button">Add</button>
                                                    <button mat-button (click)="removeTask(i)"
                                                        class="cancel-button">Remove</button>
                                                </div>
                                                <div class="col"></div>
                                            </div>
                                        </div>
                                    </mat-card>
                                </div>
                            </div>
                        </div>
                    </form> -->

                </div>
            </div>
        </form>

    </div>

</div>



<div class="container-fluid mobileView">
    <!-- <div class="row mx-1 my-2">
        <div class="col-sm">
            <h1>
                <i class="bi bi-arrow-left" (click)="goBack($event)"></i> Add project
            </h1>
        </div>
    </div> -->
    <div class="generic-form bg mx-1">
        <form [formGroup]='projectForm' (ngSubmit)='addProject()'>
            <div class="row create-project">
                <div class="col-12">
                    <div class="row">
                        <h4><i class="bi bi-arrow-left mx-2" (click)="goBack($event)"></i>Project details</h4>
                    </div>
                    <div class="row mt-3 mx-1">
                        <!-- client dropdown -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Select Client <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="client_id" autocomplete="off" placeholder="Select"
                                    panelClass="custom-select-panel" [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of allClientList" [value]="item.id">
                                        {{item.clint_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['client_id']?.touched && f['client_id']?.invalid">
                                <span class="text-errors" *ngIf="f['client_id'].errors?.['required']">Client name is
                                    required</span>
                            </div>
                        </div>
                        <!-- project name -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Enter Project Name <b class="r-star">*</b></mat-label>
                                <input matInput placeholder="Enter project name" formControlName="project_name"
                                    autocomplete="off">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['project_name']?.touched && f['project_name']?.invalid">
                                <span class="text-errors"
                                    *ngIf="f['project_name'].errors && f['project_name'].errors['required'] ">Project name is
                                    required</span>
                                <span class="text-errors"
                                    *ngIf="f['project_name'].invalid && f['project_name'].hasError('pattern')">
                                    Cannot start with a space.
                                </span>
                            </div>
                        </div>
                        <!-- start date -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                <mat-label>Start Date <b class="r-star">*</b></mat-label>
                                <input matInput [matDatepicker]="picker3" placeholder="Enter start date"
                                formControlName="start_date" autocomplete="off" (dateInput)="onChange($event)">
                                <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                                 <mat-datepicker #picker3></mat-datepicker>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['start_date']?.touched && f['start_date']?.invalid">
                                <span class="text-errors" *ngIf="f['start_date'].errors?.['required']">Start date
                                    is required</span>
                            </div>
                        </div>
                        <!-- end date -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                <mat-label>End Date <b class="r-star">*</b></mat-label>
                                <input matInput  [matDatepicker]="picker4" placeholder="Enter end date"
                                    formControlName="end_date" (dateInput)="yearEndDateValidator()"
                                    [min]="projectForm.value.start_date">
                                <mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
                                    <mat-datepicker #picker4></mat-datepicker>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['end_date']?.touched && f['end_date']?.invalid">
                                <span class="text-errors" *ngIf="f['end_date'].errors?.['required']">End date is
                                    required</span>
                            </div>
                        </div>
                        <!-- select team -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                <mat-label>Select Team <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="team" autocomplete="off"
                                    placeholder="Select team" panelClass="custom-select-panel"
                                    [disableOptionCentering]="true" multiple (selectionChange)="matTeamSelect()"
                                    [(ngModel)]="selectedTeamId">
                                    <mat-option *ngFor="let item of allPeopleGroup" [value]="item.id ">
                                        {{item.first_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['team'].touched && f['team'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['team'].errors && f['team'].errors['required']">Team
                                    list is required</span>
                            </div>
                        </div>
                        <!-- project manager -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Project Manager <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="project_manager_id" autocomplete="off"
                                    placeholder="Select manager" panelClass="custom-select-panel"
                                    [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of allManager" [value]="item.id">
                                        {{item.u_first_name +" "+ item.u_last_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2"
                                *ngIf="f['project_manager_id']?.touched && f['project_manager_id']?.invalid">
                                <span class="text-errors"
                                    *ngIf="f['project_manager_id'].errors?.['required']">Manager is
                                    required</span>
                            </div>
                        </div>
                        <!-- estimated hours -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Estimated Hours <b class="r-star">*</b></mat-label>
                                <input matInput type="number" onkeydown="return event.keyCode !== 69"
                                    oninput="this.value = this.value.replace('.', '').replace(/[^\d]/g, '');" appHypen
                                    formControlName="estimated_hour" placeholder="Enter estimated hours">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['estimated_hour'].touched && f['estimated_hour'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['estimated_hour'].errors && f['estimated_hour'].errors['required']">Estimated
                                    hours is required</span>
                            </div>
                        </div>
                        <!-- billing -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Estimated Billing <b class="r-star">*</b></mat-label>
                                <input matInput placeholder="Enter billing amount"
                                    onkeydown="return event.keyCode !== 69 " formControlName="estimated_billing"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['estimated_billing'].touched && f['estimated_billing'].invalid">
                                <span class="text-errors"
                                    *ngIf="f['estimated_billing'].errors && f['estimated_billing'].errors['required']">Estimated
                                    billing is required</span>
                            </div>
                        </div>
                        <!-- project status -->
                        <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                                <mat-label>Project Status <b class="r-star">*</b></mat-label>
                                <mat-select formControlName="status_id" autocomplete="off" placeholder="Select status"
                                    panelClass="custom-select-panel" [disableOptionCentering]="true">
                                    <mat-option *ngFor="let item of status" [value]="item.id">
                                        {{item.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div class="px-2" *ngIf="f['status_id']?.touched && f['status_id']?.invalid">
                                <span class="text-errors" *ngIf="f['status_id'].errors?.['required']">Status is
                                    required</span>
                            </div>
                        </div>
                    </div>

                    <!-- project template -->
                    <div class="row px-3 gx-0 task-border">
                        <div class="col-12 ">
                            <div class="py-3">
                                <h5 class="py-1"><b>Add Tasks</b></h5>
                                <p>Create multiple tasks</p>
                            </div>
                        </div>
                        <div class="col-12 text-end align-content-center"
                            *ngIf="projectForm.get('project_task').valid">
                            <div *ngIf="projectForm.get('project_task').valid">
                                <button mat-icon-button class="proceedbtn" type="button" color="primary"
                                    (click)="addTask()">
                                    <mat-icon>add</mat-icon>Add Task 
                                </button>
                            </div>
                        </div>
                        <div class="col-12 text-end align-content-center invalid-button"
                            *ngIf="projectForm.get('project_task').invalid">
                            <div *ngIf="projectForm.get('project_task').invalid">
                                <button mat-icon-button type="button" class="proceedbtn" color="primary" disabled>
                                    <mat-icon>add</mat-icon>Add Task 
                                </button>
                            </div>
                        </div>
                        <div class="col-12 mt-2">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <mat-form-field appearance="outline" class="w-100 p-0 custom-mat-form-field">
                                        <mat-label>Choose Template <b class="r-star">*</b></mat-label>
                                        <mat-select formControlName="project_category" autocomplete="off"
                                            placeholder="Select template" panelClass="custom-select-panel"
                                            [disableOptionCentering]="true" (selectionChange)="getSubTask($event)">
                                            <mat-option *ngFor="let item of taskCategories" [value]="item.id">
                                                {{item.category_name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 px-2" formArrayName="project_task">
                            <div class="" *ngFor="let task of subTasks.controls; let i = index;">
                                <div [formGroupName]="i" class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-10 mb-3">
                                        <div class="row align-items-center border rounded"
                                            [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}"
                                            style="border-color: #007bff;">
                                            <div class="col-auto border-end">
                                                <span class="font-weight-bold">{{i+1}}</span>
                                            </div>
                                            <div class="col mt-1 border-end">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Task Name</mat-label><b class="r-star">*</b>
                                                </div>
                                                <input matInput type="text" [formControlName]="'task_name'" [ngClass]="{'auto-height': true}"
                                                    placeholder="Enter task name" [readonly]="task.value.edit_icon"
                                                    [ngStyle]="{'background-color': task.value.edit_icon ? '#F4F4F4' : 'white'}">
                                                <!-- </textarea> -->
                                            </div>
                                            <div class="col border-end">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Status</mat-label><b class="r-star">*</b>
                                                </div>
                                                <mat-select [formControlName]="'status'" autocomplete="off"
                                                        placeholder="Select status" panelClass="custom-select-panel"
                                                        [disableOptionCentering]="true">
                                                        <mat-option [disabled]="task.value.edit_icon"
                                                        *ngFor="let status of status" [value]="status.value">
                                                        {{status.viewValue}}
                                                        </mat-option>
                                                </mat-select>
                                            </div>
                                            <div class="col mt-1">
                                                <div class="p-ab">
                                                    <mat-label class="task-labels">Assignee</mat-label><b class="r-star">*</b>
                                                </div>
                                                <mat-select [formControlName]="'assignee'" autocomplete="off"
                                                        placeholder="Select assignee" panelClass="custom-select-panel"
                                                        [disableOptionCentering]="true">
                                                        <mat-option [disabled]="task.value.edit_icon"
                                                            *ngFor="let item of assigneePeoples" [value]="item.id">
                                                            {{item.u_first_name}}
                                                        </mat-option>
                                                </mat-select>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-auto">

                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('task_name').invalid && (task.get('task_name').dirty || task.get('task_name').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('task_name')?.errors?.['required']">
                                                        Task name is required.
                                                    </span>
                                                    <span class="text-errors"
                                                        *ngIf="task.get('task_name').invalid && task.get('task_name').hasError('pattern')">
                                                        Cannot start with a space.
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('status').invalid && (task.get('status').dirty || task.get('status').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('status')?.errors?.['required']">
                                                        Status is required.
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="px-2"
                                                    *ngIf="task.get('assignee').invalid && (task.get('assignee').dirty || task.get('assignee').touched)">
                                                    <span class="text-errors"
                                                        *ngIf="subTasks.controls[i]?.get('assignee')?.errors?.['required']">
                                                        Assignee is required.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2 mb-3 d-flex ps-4 align-items-center">
                                        <i class="bi bi-check-lg me-1 icon-bg" *ngIf="!task.value.is_saved"
                                            container="body" style="color:#50C20D;" (click)="save(i)"
                                            ngbTooltip="Save"></i>
                                        <i class="bi bi-x-circle icon-bg" container="body"
                                            *ngIf="!task.value.is_saved && task.value.is_cancelled"
                                            style="color:#126EB4;margin-right: 5px;" ngbTooltip="Cancel"
                                            (click)="cancelEdit(i)"></i>
                                        <i class="bi bi-pencil-square me-1 icon-bg" *ngIf="task.value.is_saved"
                                            container="body" style="color:#367ab7;" (click)="editTask(i)"
                                            ngbTooltip="Edit"></i>
                                        <i class="bi bi-trash icon-bg"
                                            *ngIf="!task.value.is_saved && subTasks.length!=1" container="body"
                                            style="color:red;" (click)="openDeleteConfirmation(i)"
                                            ngbTooltip="Delete"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        <div class="col-sm"></div>
                        <div class="col-sm-2">
                            <button mat-raised-button class="proceedbtn mat-btn-s" type="submit">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>

</div>