

<div class="container-fluid">
  <div class="generic-form bg mx-1">
      
    <div class="text-end">
      <button mat-raised-button (click)="addProjectDetails()" [disabled]="timeSheetForm.invalid && tasks.invalid" class="mat-btn-s mx-2">+ Add More</button>
        
      <button mat-raised-button class="mat-btn-s" type="submit" (click)="addTimeSheet()">Save</button>
    </div>
    <form [formGroup]="timeSheetForm"> 
      <mat-accordion  class="p-2 mb-0">
        <mat-expansion-panel>
        
          <mat-expansion-panel-header style="box-shadow: rgba(33, 35, 38, 0.1) 0px 10px 10px -10px;">
           
            <mat-panel-title>
              
              <div> # <b>|</b> {{'Timesheet'}}</div>
            
            </mat-panel-title>
            <mat-panel-description>
             
            </mat-panel-description>
          
          </mat-expansion-panel-header>
          <div formArrayName="response">
            <div *ngFor="let project of createdProject.controls; let i=index" [formGroupName]="i">
   
          <div class="row">
            <!-- Client Selection -->
            <div class="col-sm-12 col-md-6 col-lg-3 p-0">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Client <span>*</span></mat-label>
                <mat-select (selectionChange)="getProject($event.value, i)" formControlName="client_id">
                  <mat-option value="" disabled>Select client</mat-option>
                  <mat-option *ngFor="let item of allClient" [value]="item.id">{{ item.c_name }}</mat-option>
                </mat-select>
                <mat-error *ngIf="project.get('client_id').hasError('required')">
                  Client name is required.
                </mat-error>
              </mat-form-field>
            </div>
          
            <!-- Project Selection -->
            <div class="col-sm-12 col-md-6 col-lg-3 p-0">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Project <span>*</span></mat-label>
                <mat-select (selectionChange)="getTask($event.value, i)" formControlName="project_id">
                  <mat-option value="" disabled>Select project</mat-option>
                  <mat-option *ngFor="let item of createdProject.value[i]?.projectList" [value]="item.id">{{ item.p_name }}</mat-option>
                </mat-select>
                <mat-error *ngIf="project.get('project_id').hasError('required')">
                  Project name is required.
                </mat-error>
              </mat-form-field>
            </div>
          
            
            <!-- Date Selection --->
            <div class="col-sm-12 col-md-6 col-lg-3 p-0">
              <mat-form-field appearance="outline" class="full-width date-picker" >
                <mat-label> Created Date <span>*</span></mat-label>
                <input matInput [matDatepicker]="picker" formControlName="timesheet_applied_datetime" placeholder="Select date">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-error *ngIf="project.get('timesheet_applied_datetime').hasError('required')">
                Created date is required.
                </mat-error>
              </mat-form-field>
            </div>
            <!-- Description --->
            <div class="col-sm-12 col-md-6 col-lg-3 p-0">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Description</mat-label>
                <textarea matInput formControlName="description" placeholder="Enter description"></textarea>
                <mat-error *ngIf="project.get('description').hasError('pattern')">
                  Cannot start with a space.
                </mat-error>
              </mat-form-field>
            </div>
          
            
            
                 

          </div>
         </div>
          </div>
    
        
      
       <div class="p-0 m-0" formArrayName="tasks">
        <div class="p-0 m-0" *ngFor="let task of createdTask.controls; let i = index" [formGroupName]="i">
          <div class="row me-3 mt-2">
            <div class="col-11 pe-0">
              <div class="row-container editable">
                <div class="column">
                 <mat-form-field>
                    <mat-label class="">Task name  <b class="r-star">*</b></mat-label>
                 
                   <mat-select   formControlName="task_id" (selectionChange)="getTimeSpent($event.value, i)" placeholder="Select task">
                <mat-option *ngFor="let item of createdProject.value[i]?.taskList" [value]="item.id">
                  {{ item.task_name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="task.get('task_id').hasError('required')" >
                Task is required.
              </mat-error>
            </mat-form-field>
               
                  
                </div>
                <div class="column">
                
                  <mat-form-field>
                    <mat-label>Hours <span>*</span></mat-label>
                    <mat-select formControlName="time_spent" placeholder="Select hours">
                      <mat-option *ngFor="let item of createdProject.value[i]?.time" [value]="item.time">{{ item.time }}</mat-option>
                    </mat-select>
                    <mat-error *ngIf="task.get('time_spent').hasError('required')">
                      Hours is required.
                    </mat-error>
                  </mat-form-field>
                </div>
               
            
          
          </div>
            </div>
            <div class="col-1  d-flex justify-content-center align-items-center"  *ngIf="i===0">
              <img src="../../../../assets/images/tick.svg" class="icon-image" container="body"  ngbTooltip="Add" (click)="addTask();"/>
              <img src="../../../../assets/images/Close.svg" class="icon-image"  container="body" ngbTooltip="Cancel"  />
            </div>
            <div class="col-1  d-flex justify-content-center align-items-center"  *ngIf="i>0">
              <img src="../../../../assets/images/tick.svg" class="icon-image" container="body"  ngbTooltip="Add" />
              <img src="../../../../assets/images/Close.svg" class="icon-image"  container="body" ngbTooltip="Cancel"  />
              <img src="../../../../assets/images/Delete.svg" class="icon-image"  container="body" ngbTooltip="Delete"  />
            </div>
          </div>
   

      
    
    </div>
        </div>
        </mat-expansion-panel>
      </mat-accordion> 

     
    </form>
  </div>
</div>
